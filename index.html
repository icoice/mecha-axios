<html>
    <header>
        <title>test</title>
        <script src="./lib/index.window.js"></script>
    </header>
    <body>
        <script>
            // 假axios
            const axios = (payload) => {
                return new Promise((resolve, reject) => {
                    const xhr = new XMLHttpRequest();
                    let query = Object.entries(payload.params).map(([k, v]) => `${k}=${encodeURIComponent(v)}`).join('&')

                    if (query.length > 0) query = '?' + query
    
                    xhr.open(payload.method, payload.url + query, true);

                    xhr.responseType = 'json';

                    xhr.onload = function() {
                        if (xhr.status === 200) {
                            resolve(xhr.response)
                        } else {
                            reject(xhr.response)
                        }
                    };

                    xhr.onerror = function(e) {
                        reject(e)
    
                        throw e
                    };

                    xhr.send();
                })
            }

            const { AxiosDecorator, CreviceApi } = window

            const  api = new CreviceApi({
                host: 'https://api.openweathermap.org',
                request: payload => axios(payload),
                requestProxy(request) {
                    if (true) return request
                    return payload => axios(payload)
                },
                sendSuccess(response) {
                    return response
                },
                sendFail(error) {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            reject({
                                error,
                                content: 'Alter Error Content'
                            })
                        }, 2000);
                    })
                },
                list: [
                    {
                        name: 'weatherCall',
                        method: 'GET',
                        path: '/data/3.0/onecall',
                        paramMap: [
                            'lat',
                            'lon',
                            'exclude',
                            'appid'
                        ]
                    }
                ],
            })

            api.weatherCall({
                lat: 22.5431,
                lon: 114.0579,
                appid: 'cc0eb5e33785704759399aec22517bbc',
            }).then(response => {
                console.log(response)
            }).catch(e => {
                console.log(e)
            })
        </script>
    </body>
</html>